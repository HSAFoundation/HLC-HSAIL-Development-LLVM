; RUN: llc -march=hsail -verify-machineinstrs < %s | FileCheck -check-prefix=HSAIL -check-prefix=FUNC %s

; HSAIL: prog readonly_u8 &gval_init_true = 1;
; HSAIL; prog readonly_u8 &gval_init_false = 0;
; HSAIL: prog readonly_u8 &gval_undef;
; HSAIL: prog align(4) readonly_u8 &gval_arr_zeroinit[1024] = {0};
; HSAIL: prog align(4) readonly_u8 &gval_arr10_init[10] = {1, 0, 1, 0, 1, 0, 1, 0, 1, 0};
; HSAIL: prog align(4) readonly_u8 &gval_arr3_init[3] = {1, 0, 1};
; HSAIL: prog align(4) readonly_u8 &gval_arr8_init[8] = {1, 0, 1, 1, 0, 1, 1, 1};

@gval_init_true = addrspace(2) global i1 true
@gval_init_false = addrspace(2) global i1 false
@gval_undef = addrspace(2) global i1 undef

@gval_arr_zeroinit = addrspace(2) global [1024 x i1] zeroinitializer
@gval_arr10_init = addrspace(2) global [10 x i1] [i1 true, i1 false, i1 true, i1 false, i1 true, i1 false, i1 true, i1 false, i1 true, i1 false]
@gval_arr3_init = addrspace(2) global [3 x i1] [i1 true, i1 false, i1 true]
@gval_arr8_init = addrspace(2) global [8 x i1] [i1 true, i1 false, i1 true, i1 true, i1 false, i1 true, i1 true, i1 true]

@gval = addrspace(3) global i1 undef
@gval_arr = addrspace(3) global [1024 x i1] undef

; FIXME: i1 vector initializers don't work.


; FIXME: Why isn't this declared as i8?
; HSAIL-LABEL: {{^}}prog function &load_i1_global
; HSAIL: group_u8 %gval;
; HSAIL: ld_group_u8 {{\$s[0-9]+}}, [%gval];
define void @load_i1_global(i32 addrspace(1)* %out) {
  %ld = load i1 addrspace(3)* @gval
  %val = zext i1 %ld to i32
  store i32 %val, i32 addrspace(1)* %out
  ret void
}

; FIXME: Why isn't this declared as b8?
; HSAIL-LABEL: {{^}}prog function &load_i1_arr_global
; HSAIL: align(4) group_u8 %gval_arr[1024];
; HSAIL: ld_group_u8 {{\$s[0-9]+}}, [%gval_arr][7];
define void @load_i1_arr_global(i32 addrspace(1)* %out) {
 %gep = getelementptr [1024 x i1] addrspace(3)* @gval_arr, i32 0, i32 7
  %ld = load i1 addrspace(3)* %gep
  %val = zext i1 %ld to i32
  store i32 %val, i32 addrspace(1)* %out
  ret void
}
